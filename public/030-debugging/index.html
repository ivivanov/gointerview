<!DOCTYPE html>
<html lang="en-us" dir="ltr">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="
  Questions?
  #


What are some best practices for writing unit tests in Go? How do you handle mocking dependencies? 
  read
Explain how to use table-driven tests in Go with an example. 
  read
How do you debug memory leaks in Golang applications? Provide an example of using memory profiling tools like pprof. 
  read
How do you debug concurrent code in Go?
What is pprof and how do you use it to analyze goroutine stacks?


  Answers:
  #


  1. How do you debug concurrent code in Go?
  #

Here are some examples of how to debug concurrent code in Go:">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#343a40">
<meta name="color-scheme" content="light dark"><meta property="og:url" content="http://localhost:1313/030-debugging/">
  <meta property="og:site_name" content="Go Interview">
  <meta property="og:title" content="Debugging">
  <meta property="og:description" content="Questions? # What are some best practices for writing unit tests in Go? How do you handle mocking dependencies? read Explain how to use table-driven tests in Go with an example. read How do you debug memory leaks in Golang applications? Provide an example of using memory profiling tools like pprof. read How do you debug concurrent code in Go? What is pprof and how do you use it to analyze goroutine stacks? Answers: # 1. How do you debug concurrent code in Go? # Here are some examples of how to debug concurrent code in Go:">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:published_time" content="2025-02-28T15:49:40+02:00">
    <meta property="article:modified_time" content="2025-02-28T15:49:40+02:00">
<title>Debugging | Go Interview</title>
<link rel="icon" href="/favicon.png" >
<link rel="manifest" href="/manifest.json">
<link rel="canonical" href="http://localhost:1313/030-debugging/">
<link rel="stylesheet" href="/book.min.a1f07700b6a43252e796ba04c90c1bfdddc8f2dbc7dc0eb22bc62a17d4940fd1.css" integrity="sha256-ofB3ALakMlLnlroEyQwb/d3I8tvH3A6yK8YqF9SUD9E=" crossorigin="anonymous">
  <script defer src="/fuse.min.js"></script>
  <script defer src="/en.search.min.da3b8b4a5b28b8ab2e219b99a2e5e62bde85c7d77389e5da67fca9da6966a311.js" integrity="sha256-2juLSlsouKsuIZuZouXmK96Fx9dzieXaZ/yp2mlmoxE=" crossorigin="anonymous"></script>

  <script defer src="/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js" integrity="sha256-b2&#43;Q/LjrHEnsOJg45rgB0N4ZQwuOUWkC&#43;NdcPIvZhzk=" crossorigin="anonymous"></script>

      <script async src="https://www.googletagmanager.com/gtag/js?id=G-SMC54680CC"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-SMC54680CC');
        }
      </script><!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><span>Go Interview</span>
  </a>
</h2>


<div class="book-search hidden">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>
<script>document.querySelector(".book-search").classList.remove("hidden")</script>













  



  
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/010-basics/" class="">Basics</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/020-concurrency/" class="">Concurrency</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/030-debugging/" class="active">Debugging</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/040-advanced-concepts/" class="">Advanced Concepts</a>
  

        </li>
      
    
  </ul>














</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <h3>Debugging</h3>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#questions">Questions?</a></li>
    <li><a href="#answers">Answers:</a>
      <ul>
        <li><a href="#1-how-do-you-debug-concurrent-code-in-go">1. How do you debug concurrent code in Go?</a></li>
        <li><a href="#2-what-is-pprof-and-how-do-you-use-it-to-analyze-goroutine-stacks">2. What is pprof and how do you use it to analyze goroutine stacks?</a></li>
      </ul>
    </li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown book-article"><h2 id="questions">
  Questions?
  <a class="anchor" href="#questions">#</a>
</h2>
<ol>
<li>What are some best practices for writing unit tests in Go? How do you handle mocking dependencies? 
  <a href="/">read</a></li>
<li>Explain how to use table-driven tests in Go with an example. 
  <a href="/">read</a></li>
<li>How do you debug memory leaks in Golang applications? Provide an example of using memory profiling tools like <code>pprof</code>. 
  <a href="/">read</a></li>
<li>How do you debug concurrent code in Go?</li>
<li>What is pprof and how do you use it to analyze goroutine stacks?</li>
</ol>
<h2 id="answers">
  Answers:
  <a class="anchor" href="#answers">#</a>
</h2>
<h3 id="1-how-do-you-debug-concurrent-code-in-go">
  1. How do you debug concurrent code in Go?
  <a class="anchor" href="#1-how-do-you-debug-concurrent-code-in-go">#</a>
</h3>
<p>Here are some examples of how to debug concurrent code in Go:</p>
<ul>
<li>
<p>Using Delve debugger:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>dlv debug
</span></span><span style="display:flex;"><span><span style="color:#f92672">(</span>dlv<span style="color:#f92672">)</span> break main.go:line
</span></span><span style="display:flex;"><span><span style="color:#f92672">(</span>dlv<span style="color:#f92672">)</span> <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">(</span>dlv<span style="color:#f92672">)</span> goroutines
</span></span><span style="display:flex;"><span><span style="color:#f92672">(</span>dlv<span style="color:#f92672">)</span> goroutine <span style="color:#ae81ff">1</span> next
</span></span><span style="display:flex;"><span><span style="color:#f92672">(</span>dlv<span style="color:#f92672">)</span> print var_name
</span></span><span style="display:flex;"><span><span style="color:#f92672">(</span>dlv<span style="color:#f92672">)</span> locals
</span></span></code></pre></div></li>
<li>
<p>Race detector:
A race condition occurs when two or more concurrent operations access shared data and at least one of them modifies it, potentially leading to unpredictable behavior due to the timing and sequence of the operations.</p>
<p>Example:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">counter</span> <span style="color:#66d9ef">int</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">wg</span> <span style="color:#a6e22e">sync</span>.<span style="color:#a6e22e">WaitGroup</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">wg</span>.<span style="color:#a6e22e">Add</span>(<span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">go</span> <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">wg</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">sync</span>.<span style="color:#a6e22e">WaitGroup</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">counter</span><span style="color:#f92672">++</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">wg</span>.<span style="color:#a6e22e">Done</span>()
</span></span><span style="display:flex;"><span>}(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">wg</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">go</span> <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">wg</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">sync</span>.<span style="color:#a6e22e">WaitGroup</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">counter</span><span style="color:#f92672">++</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">wg</span>.<span style="color:#a6e22e">Done</span>()
</span></span><span style="display:flex;"><span>}(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">wg</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">wg</span>.<span style="color:#a6e22e">Wait</span>()
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>go run -race .
</span></span></code></pre></div></li>
<li>
<p>Logging with goroutine IDs:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">goID</span>() <span style="color:#66d9ef">int</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">buf</span> [<span style="color:#ae81ff">64</span>]<span style="color:#66d9ef">byte</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">n</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">runtime</span>.<span style="color:#a6e22e">Stack</span>(<span style="color:#a6e22e">buf</span>[:], <span style="color:#66d9ef">false</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">idField</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">strings</span>.<span style="color:#a6e22e">Fields</span>(<span style="color:#a6e22e">strings</span>.<span style="color:#a6e22e">TrimPrefix</span>(string(<span style="color:#a6e22e">buf</span>[:<span style="color:#a6e22e">n</span>]), <span style="color:#e6db74">&#34;goroutine &#34;</span>))[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">id</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">strconv</span>.<span style="color:#a6e22e">Atoi</span>(<span style="color:#a6e22e">idField</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		panic(<span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">id</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">ch</span> <span style="color:#f92672">:=</span> make(<span style="color:#66d9ef">chan</span> <span style="color:#66d9ef">int</span>) <span style="color:#75715e">// Unbuffered channel</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">go</span> <span style="color:#66d9ef">func</span>() {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;Goroutine %d: Starting work&#34;</span>, <span style="color:#a6e22e">goID</span>())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">ch</span> <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">42</span> <span style="color:#75715e">// Blocks until receiver is ready</span>
</span></span><span style="display:flex;"><span>	}()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">value</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&lt;-</span><span style="color:#a6e22e">ch</span> <span style="color:#75715e">// Blocks until sender sends data</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">value</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div></li>
<li>
<p>Visualizing goroutines with execution trace:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>go test -trace trace.out
</span></span><span style="display:flex;"><span>go tool trace trace.out
</span></span></code></pre></div></li>
<li>
<p>Naming goroutines for easier identification:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">runtime</span>.<span style="color:#a6e22e">SetFinalizer</span>(<span style="color:#66d9ef">go</span> <span style="color:#66d9ef">func</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">debug</span>.<span style="color:#a6e22e">SetGoroutineLabels</span>(<span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">TODO</span>(), <span style="color:#e6db74">&#34;worker&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// ... worker logic</span>
</span></span><span style="display:flex;"><span>}(), <span style="color:#66d9ef">nil</span>)
</span></span></code></pre></div></li>
</ul>
<p>These examples demonstrate various techniques for debugging concurrent Go code, from using specialized debuggers to leveraging built-in Go tools for analysis and visualization.</p>
<hr>
<h3 id="2-what-is-pprof-and-how-do-you-use-it-to-analyze-goroutine-stacks">
  2. What is pprof and how do you use it to analyze goroutine stacks?
  <a class="anchor" href="#2-what-is-pprof-and-how-do-you-use-it-to-analyze-goroutine-stacks">#</a>
</h3>
<p><code>pprof</code> is a powerful profiling tool for Go programs that allows developers to analyze CPU usage, memory allocations, and goroutine behavior. It&rsquo;s part of the Go standard library and can generate detailed profiles of Go programs. To use pprof for analyzing goroutine stacks:</p>
<h4 id="enable-profiling-in-your-go-program">
  Enable profiling in your Go program:
  <a class="anchor" href="#enable-profiling-in-your-go-program">#</a>
</h4>
<ul>
<li>Import the pprof package: <code>import _ &quot;net/http/pprof&quot;</code></li>
<li>Start an HTTP server:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">go</span> <span style="color:#66d9ef">func</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">ListenAndServe</span>(<span style="color:#e6db74">&#34;localhost:1414&#34;</span>, <span style="color:#66d9ef">nil</span>))
</span></span><span style="display:flex;"><span>}()
</span></span></code></pre></div><h4 id="generate-a-goroutine-profile">
  Generate a goroutine profile:
  <a class="anchor" href="#generate-a-goroutine-profile">#</a>
</h4>
<ul>
<li>Access the pprof endpoint: <code>http://localhost:1414/debug/pprof/goroutine?debug=2</code></li>
<li>This provides a full goroutine stack dump</li>
</ul>
<h4 id="analyze-the-profile">
  Analyze the profile:
  <a class="anchor" href="#analyze-the-profile">#</a>
</h4>
<ul>
<li>Use the <code>go tool pprof</code> command to examine the generated profile</li>
<li>For example: <code>go tool pprof http://localhost:1414/debug/pprof/goroutine</code></li>
</ul>
<h4 id="interpret-the-results">
  Interpret the results:
  <a class="anchor" href="#interpret-the-results">#</a>
</h4>
<ul>
<li>pprof groups goroutines by stack trace signature</li>
<li>It provides information on goroutine states, function calls, and parameter signatures</li>
</ul>
<h4 id="visualize-the-data">
  Visualize the data:
  <a class="anchor" href="#visualize-the-data">#</a>
</h4>
<ul>
<li>pprof can generate various reports, including CPU usage summaries, memory allocation details, and flame graphs</li>
</ul>
<p>By using pprof to analyze goroutine stacks, developers can identify issues such as goroutine leaks, deadlocks, and performance bottlenecks in their Go programs.</p>
<hr>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">




  <div>
    <a class="flex align-center" href="https://github.com/ivivanov/gointerview/edit/master/content/030-debugging.md" target="_blank" rel="noopener">
      <img src="/svg/edit.svg" class="book-icon" alt="" />
      <span>Edit this page</span>
    </a>
  </div>


</div>



  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#questions">Questions?</a></li>
    <li><a href="#answers">Answers:</a>
      <ul>
        <li><a href="#1-how-do-you-debug-concurrent-code-in-go">1. How do you debug concurrent code in Go?</a></li>
        <li><a href="#2-what-is-pprof-and-how-do-you-use-it-to-analyze-goroutine-stacks">2. What is pprof and how do you use it to analyze goroutine stacks?</a></li>
      </ul>
    </li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












